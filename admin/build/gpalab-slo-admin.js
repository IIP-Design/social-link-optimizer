(()=>{"use strict";const t=t=>{document.querySelectorAll(".gpalab-slo-tab-button").forEach((e=>{e.id===`gpalab-slo-tab-${t}`?(e.focus(),e.setAttribute("aria-selected","true"),e.removeAttribute("tabindex")):(e.removeAttribute("aria-selected"),e.setAttribute("tabindex","-1"))})),document.querySelectorAll(".gpalab-slo-tabpanel").forEach((e=>{e.id===`gpalab-slo-settings-${t}`?e.style.display="flex":e.style.display="none"}))},e=e=>{const a=document.querySelectorAll(".gpalab-slo-tab-button");if(null!==e)switch(e){case-1:t(a[a.length-1].dataset.id);break;case a.length:t(a[0].dataset.id);break;default:t(a[e].dataset.id)}},a=t=>{const{origin:e,pathname:a,search:n}=window.location;window.location.href=`${e}${a}${n}#gpalab-slo-tab-${t}`,window.location.reload()},n=window.wp.i18n;var o=['a[href]:not([tabindex^="-"])','area[href]:not([tabindex^="-"])','input:not([type="hidden"]):not([type="radio"]):not([disabled]):not([tabindex^="-"])','input[type="radio"]:not([disabled]):not([tabindex^="-"])','select:not([disabled]):not([tabindex^="-"])','textarea:not([disabled]):not([tabindex^="-"])','button:not([disabled]):not([tabindex^="-"])','iframe:not([tabindex^="-"])','audio[controls]:not([tabindex^="-"])','video[controls]:not([tabindex^="-"])','[contenteditable]:not([tabindex^="-"])','[tabindex]:not([tabindex^="-"])'];function i(t){this._show=this.show.bind(this),this._hide=this.hide.bind(this),this._maintainFocus=this._maintainFocus.bind(this),this._bindKeypress=this._bindKeypress.bind(this),this.$el=t,this.shown=!1,this._id=this.$el.getAttribute("data-a11y-dialog")||this.$el.id,this._previouslyFocused=null,this._listeners={},this.create()}function s(t,e){return a=(e||document).querySelectorAll(t),Array.prototype.slice.call(a);var a}function l(t){(t.querySelector("[autofocus]")||t).focus()}function d(){s("[data-a11y-dialog]").forEach((function(t){new i(t)}))}i.prototype.create=function(){return this.$el.setAttribute("aria-hidden",!0),this.$el.setAttribute("aria-modal",!0),this.$el.setAttribute("tabindex",-1),this.$el.hasAttribute("role")||this.$el.setAttribute("role","dialog"),this._openers=s('[data-a11y-dialog-show="'+this._id+'"]'),this._openers.forEach(function(t){t.addEventListener("click",this._show)}.bind(this)),this._closers=s("[data-a11y-dialog-hide]",this.$el).concat(s('[data-a11y-dialog-hide="'+this._id+'"]')),this._closers.forEach(function(t){t.addEventListener("click",this._hide)}.bind(this)),this._fire("create"),this},i.prototype.show=function(t){return this.shown||(this._previouslyFocused=document.activeElement,this.$el.removeAttribute("aria-hidden"),this.shown=!0,l(this.$el),document.body.addEventListener("focus",this._maintainFocus,!0),document.addEventListener("keydown",this._bindKeypress),this._fire("show",t)),this},i.prototype.hide=function(t){return this.shown?(this.shown=!1,this.$el.setAttribute("aria-hidden","true"),this._previouslyFocused&&this._previouslyFocused.focus&&this._previouslyFocused.focus(),document.body.removeEventListener("focus",this._maintainFocus,!0),document.removeEventListener("keydown",this._bindKeypress),this._fire("hide",t),this):this},i.prototype.destroy=function(){return this.hide(),this._openers.forEach(function(t){t.removeEventListener("click",this._show)}.bind(this)),this._closers.forEach(function(t){t.removeEventListener("click",this._hide)}.bind(this)),this._fire("destroy"),this._listeners={},this},i.prototype.on=function(t,e){return void 0===this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(e),this},i.prototype.off=function(t,e){var a=(this._listeners[t]||[]).indexOf(e);return a>-1&&this._listeners[t].splice(a,1),this},i.prototype._fire=function(t,e){var a=this._listeners[t]||[],n=new CustomEvent(t,{detail:e});this.$el.dispatchEvent(n),a.forEach(function(t){t(this.$el,e)}.bind(this))},i.prototype._bindKeypress=function(t){this.$el.contains(document.activeElement)&&(this.shown&&"Escape"===t.key&&"alertdialog"!==this.$el.getAttribute("role")&&(t.preventDefault(),this.hide(t)),this.shown&&"Tab"===t.key&&function(t,e){var a=function(t){return s(o.join(","),t).filter((function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)}))}(t),n=a.indexOf(document.activeElement);e.shiftKey&&0===n?(a[a.length-1].focus(),e.preventDefault()):e.shiftKey||n!==a.length-1||(a[0].focus(),e.preventDefault())}(this.$el,t))},i.prototype._maintainFocus=function(t){!this.shown||t.target.closest('[aria-modal="true"]')||t.target.closest("[data-a11y-dialog-ignore-focus-trap]")||l(this.$el)},"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):window.requestAnimationFrame?window.requestAnimationFrame(d):window.setTimeout(d,16));const r=(t,e,a)=>{const o=document.getElementById(`slo-avatar-${a}`),i=document.getElementById(`slo-avatar-preview-${a}`),s=document.getElementById(`slo-avatar-placeholder-${a}`),l=o.value!=e;i&&l&&(i.style.display="none"),s&&t?(l&&(s.style.display="block"),s.innerText=t):s&&(s.style.display="block",s.innerText=(0,n.__)("No avatar added","gpalab-slo")),o.value=e;document.getElementById(`slo-avatar-manager-${a}`).value=t?(0,n.__)("Change avatar image","gpalab-slo"):(0,n.__)("Select an avatar image","gpalab-slo");document.getElementById(`slo-avatar-remove-${a}`).style.display=t?"block":"none"},c=()=>{const o=document.querySelectorAll(".gpalab-slo-tab-button");o.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const{id:a}=e.target.dataset;t(a)}))})),o.forEach(((t,a)=>{t.addEventListener("keydown",(t=>{switch(t.which){case 37:e(a-1);break;case 39:e(a+1);break;case 40:t.preventDefault(),document.getElementById(`title_${a}`).focus();break;default:return null}}))})),document.getElementById("slo-add-mission").addEventListener("click",(()=>{(async t=>{var e;const n=(null===(e=window)||void 0===e?void 0:e.gpalabSloAdmin)||{},o=new FormData;o.append("action","gpalab_add_slo_mission"),o.append("security",n.sloNonce);try{const e=await fetch(n.ajaxUrl,{method:"POST",body:o}),i=await e.json();console.log(i),a(t)}catch(t){console.error(t)}})(o.length)}));const s=document.querySelectorAll(".slo-remove-mission"),l=document.getElementById("gpalab-slo-removal-confirmation-dialog"),d=document.getElementById("gpalab-slo-dialog-title");s.forEach((t=>{t.addEventListener("click",(t=>{const{id:e}=t.target.dataset,a=[...o].filter((t=>void 0!==t.attributes["aria-selected"])),i=a[0].dataset.id,s=i>0?i-1:0,r=`Are you sure you want to delete the ${a[0].innerText} page?`;d.textContent=(0,n.__)(r,"gpalab-slo"),l.dataset.id=e,l.dataset.idxafter=s}))}));const c=new i(l,"#wpwrap");document.getElementById("remove-affirmative").addEventListener("click",(()=>{const{id:t,idxafter:e}=l.dataset;(async(t,e)=>{var n;const o=(null===(n=window)||void 0===n?void 0:n.gpalabSloAdmin)||{},i=new FormData;i.append("action","gpalab_remove_slo_mission"),i.append("security",o.sloNonce),i.append("mission_id",t);try{const t=await fetch(o.ajaxUrl,{method:"POST",body:i}),n=await t.json();console.log(n),a(e)}catch(t){console.error(t)}})(t,e),c.hide()})),c.on("show",(()=>{document.documentElement.style.overflow="hidden"})),c.on("hide",(()=>{document.documentElement.removeAttribute("style")})),document.querySelectorAll(".slo-submit").forEach(((t,e)=>{t.addEventListener("click",(t=>{const{post:n}=t.target.dataset;(async(t,e,n)=>{var o;const i=(null===(o=window)||void 0===o?void 0:o.gpalabSloAdmin)||{},s=new FormData;s.append("action","gpalab_update_slo_page_title"),s.append("security",i.sloNonce),s.append("post_id",t),s.append("title",e);try{const t=await fetch(i.ajaxUrl,{method:"POST",body:s}),e=await t.json();console.log(e),a(n)}catch(t){console.error(t)}})(n,document.getElementById(`title_${e}`).value,e)}))})),document.querySelectorAll(".slo-permalink").forEach(((t,e)=>{t.addEventListener("click",(t=>{const{id:n,post:o,title:i}=t.target.dataset;(async(t,e,n,o)=>{var i;const s=(null===(i=window)||void 0===i?void 0:i.gpalabSloAdmin)||{},l=new FormData;l.append("action","gpalab_update_slo_permalink"),l.append("security",s.sloNonce),l.append("permalink",n),l.append("post_id",t),l.append("title",e);try{const t=await fetch(s.ajaxUrl,{method:"POST",body:l}),e=await t.json();console.log(e),a(o)}catch(t){console.error(t)}})(o,i,document.getElementById(`permalink-${n}`).value,e)}))})),document.querySelectorAll(".gpalab-slo-avatar-media-manager").forEach((t=>{t.addEventListener("click",(t=>{const{id:e}=t.target.dataset;((t,e)=>{t.preventDefault();const{media:a}=window.wp;let o;o&&o.open(),o=a({button:{text:(0,n.__)("Use as mission avatar","gpalab-slo")},library:{type:"image"},multiple:!1,title:(0,n.__)("Add an avatar","gpalab-slo")}),o.on("close",(()=>((t,e)=>{var a,n;const o=t.state().get("selection").first(),i=null==o||null===(a=o.attributes)||void 0===a?void 0:a.filename,s=null==o||null===(n=o.attributes)||void 0===n?void 0:n.id;r(i,s,e)})(o,e))),o.on("open",(()=>((t,e)=>{const a=document.getElementById(`slo-avatar-${e}`),n=t.state().get("selection");if(a.value&&"undefined"!==a.value){const{media:t}=window.wp,e=t.attachment(a.value);e.fetch(),n.add(e?[e]:[])}else n.add([])})(o,e))),o.open()})(t,e)}))})),document.querySelectorAll(".gpalab-slo-avatar-remove").forEach((t=>{t.addEventListener("click",(t=>{const{id:e}=t.target.dataset;(t=>{r("","",t)})(e)}))}))},u=t=>{const e=document.createElement("button");let a="remove-affirmative",o="primary",i="Yes, delete";return"cancel"===t&&(a="remove-cancel",o="secondary",i="No, cancel",e.setAttribute("data-a11y-dialog-hide","")),e.setAttribute("type","button"),e.setAttribute("id",a),e.setAttribute("class",`button button-${o}`),e.textContent=(0,n.__)(i,"gpalab-slo"),e},h=()=>{const t=document.createElement("div"),e=(()=>{const t=document.createElement("div");return t.setAttribute("class","gpalab-slo-dialog-overlay"),t.setAttribute("tabindex","-1"),t.setAttribute("data-a11y-dialog-hide",""),t})(),a=(()=>{const t=document.createElement("div"),e=(()=>{const t=document.createElement("div"),e=(()=>{const t=document.createElement("h1");return t.setAttribute("id","gpalab-slo-dialog-title"),t})(),a=(()=>{const t=document.createElement("div"),e=u("cancel"),a=u("confirm");return t.setAttribute("class","gpalab-slo-dialog-actions"),t.appendChild(e),t.appendChild(a),t})();return t.setAttribute("role","document"),t.appendChild(e),t.appendChild(a),t})();return t.setAttribute("role","dialog"),t.setAttribute("aria-labelledby","gpalab-slo-dialog-title"),t.appendChild(e),t})();return t.setAttribute("id","gpalab-slo-removal-confirmation-dialog"),t.setAttribute("class","gpalab-slo-dialog-container"),t.setAttribute("aria-hidden","true"),t.appendChild(e),t.appendChild(a),t};(()=>{const t=document.getElementById("wpwrap"),e=h();t.insertAdjacentElement("afterend",e)})(),c(),(t=>{const e=document.querySelectorAll(".gpalab-slo-tab-button"),a=document.querySelectorAll(".gpalab-slo-tabpanel");if(0===e.length||0===a.length)return;const n=t>=e.length?0:t,o=[...e];o.splice(n,1),e[n].setAttribute("aria-selected","true"),a[n].style.display="flex",o.forEach((t=>{t.setAttribute("tabindex","-1")}))})((()=>{const{hash:t}=window.location,e=/(gpalab-slo-tab-[0-9]*)/g,a=t.match(e)?t.match(e)[0]:null;return a?a.replace("gpalab-slo-tab-",""):0})()||0)})();